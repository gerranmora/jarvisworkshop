<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JARVIS 3D Workshop - AI Assistant</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Orbitron', monospace;
            background: #000;
            color: #00ffff;
            overflow-x: hidden;
        }
        
        /* Background effects */
        .stars {
            position: fixed;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 60% 70%, white, transparent),
                radial-gradient(1px 1px at 50% 50%, white, transparent),
                radial-gradient(1px 1px at 80% 10%, white, transparent),
                radial-gradient(2px 2px at 90% 60%, white, transparent);
            background-size: 200% 200%;
            animation: starMove 200s linear infinite;
            opacity: 0.3;
        }
        
        @keyframes starMove {
            from { background-position: 0% 0%; }
            to { background-position: 100% 100%; }
        }
        
        .grid-overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(rgba(0,255,255,0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,255,255,0.05) 1px, transparent 1px);
            background-size: 60px 60px;
            transform: perspective(500px) rotateX(60deg);
            transform-origin: center bottom;
            opacity: 0.4;
        }
        
        .scanlines {
            position: fixed;
            width: 100%;
            height: 100%;
            background: linear-gradient(transparent 50%, rgba(0,255,255,0.02) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 9999;
        }
        
        /* Settings icon */
        .settings-icon {
            position: fixed;
            top: 50%;
            right: 30px;
            transform: translateY(-50%);
            width: 60px;
            height: 60px;
            background: rgba(0,30,50,0.9);
            border: 2px solid #00ffff;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 100;
            font-size: 1.8rem;
        }
        
        .settings-icon:hover {
            background: rgba(0,255,255,0.3);
            box-shadow: 0 0 30px rgba(0,255,255,0.8);
            transform: translateY(-50%) rotate(90deg);
        }
        
        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 50%;
            right: -500px;
            transform: translateY(-50%);
            width: 450px;
            max-height: 80vh;
            background: rgba(0,10,20,0.95);
            border: 3px solid #00ffff;
            border-right: none;
            border-radius: 15px 0 0 15px;
            padding: 40px 30px;
            transition: right 0.5s ease;
            z-index: 1001;
            overflow-y: auto;
            box-shadow: -10px 0 50px rgba(0,255,255,0.6);
        }
        
        .settings-panel.active {
            right: 0;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0,255,255,0.3);
        }
        
        .settings-title {
            font-size: 1.8rem;
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 20px rgba(0,255,255,0.8);
        }
        
        .close-settings {
            width: 40px;
            height: 40px;
            background: transparent;
            border: 2px solid #00ffff;
            border-radius: 50%;
            color: #00ffff;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-settings:hover {
            background: rgba(0,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .input-group {
            margin-bottom: 25px;
        }
        
        .input-label {
            display: block;
            margin-bottom: 10px;
            color: #00aaaa;
            font-size: 0.95rem;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        .api-input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0,50,80,0.3);
            border: 2px solid rgba(0,255,255,0.5);
            border-radius: 10px;
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .api-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0,255,255,0.4);
        }
        
        .save-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, rgba(0,200,255,0.9), rgba(0,255,255,0.9));
            border: 2px solid #00ffff;
            border-radius: 10px;
            color: #000;
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .save-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(0,255,255,0.8);
        }
        
        .info-text {
            color: #00aaaa;
            font-size: 0.85rem;
            line-height: 1.6;
            margin-top: 15px;
            padding: 15px;
            background: rgba(0,100,150,0.1);
            border-left: 3px solid rgba(0,255,255,0.4);
            border-radius: 5px;
        }
        
        /* Main interface */
        .hud-container {
            position: relative;
            width: 100vw;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }
        
        .corner-frame {
            position: fixed;
            width: 150px;
            height: 150px;
            border: 2px solid rgba(0,255,255,0.6);
            pointer-events: none;
            z-index: 10;
        }
        
        .corner-tl { top: 20px; left: 20px; border-right: none; border-bottom: none; }
        .corner-tr { top: 20px; right: 20px; border-left: none; border-bottom: none; }
        .corner-bl { bottom: 20px; left: 20px; border-right: none; border-top: none; }
        .corner-br { bottom: 20px; right: 20px; border-left: none; border-top: none; }
        
        .info-panel {
            position: fixed;
            background: rgba(0,20,30,0.7);
            border: 1px solid rgba(0,255,255,0.4);
            padding: 15px 20px;
            backdrop-filter: blur(10px);
            font-size: 0.85rem;
            z-index: 10;
        }
        
        .panel-tl { top: 40px; left: 40px; border-left: 3px solid #00ffff; }
        .panel-tr { top: 40px; right: 40px; text-align: right; border-right: 3px solid #00ffff; }
        .panel-bl { bottom: 40px; left: 40px; border-left: 3px solid #00ffff; }
        .panel-br { bottom: 40px; right: 40px; text-align: right; border-right: 3px solid #00ffff; }
        
        .panel-label {
            color: #00aaaa;
            font-size: 0.7rem;
            margin-bottom: 3px;
            letter-spacing: 1px;
        }
        
        .panel-value {
            color: #00ffff;
            font-size: 1.1rem;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0,255,255,0.6);
        }
        
        .central-system {
            position: relative;
            width: 700px;
            height: 700px;
        }
        
        .ring {
            position: absolute;
            border-radius: 50%;
            border: 2px solid;
        }
        
        .ring-1 { width: 100%; height: 100%; border-color: rgba(0,255,255,0.4); animation: rotate 40s linear infinite; }
        .ring-2 { width: 85%; height: 85%; top: 7.5%; left: 7.5%; border-color: rgba(0,200,255,0.3); animation: rotate 30s linear infinite reverse; }
        .ring-3 { width: 70%; height: 70%; top: 15%; left: 15%; border-color: rgba(0,150,255,0.3); animation: rotate 25s linear infinite; }
        .ring-4 { width: 55%; height: 55%; top: 22.5%; left: 22.5%; border-color: rgba(0,100,200,0.2); animation: rotate 20s linear infinite reverse; }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .ring::before, .ring::after {
            content: '';
            position: absolute;
            width: 8px;
            height: 8px;
            background: #00ffff;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,255,255,0.8);
        }
        
        .ring::before { top: -4px; left: 50%; transform: translateX(-50%); }
        .ring::after { bottom: -4px; left: 50%; transform: translateX(-50%); }
        
        .core {
            position: absolute;
            width: 180px;
            height: 180px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(0,255,255,0.8) 0%, rgba(0,200,255,0.5) 30%, rgba(0,150,255,0.2) 60%, transparent 100%);
            border-radius: 50%;
            border: 3px solid #00ffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            animation: corePulse 3s ease-in-out infinite;
            z-index: 100;
        }
        
        @keyframes corePulse {
            0%, 100% { box-shadow: 0 0 30px rgba(0,255,255,0.8), inset 0 0 30px rgba(0,255,255,0.4); }
            50% { box-shadow: 0 0 60px rgba(0,255,255,1), inset 0 0 40px rgba(0,255,255,0.6); }
        }
        
        .core-text {
            font-size: 1.8rem;
            font-weight: 900;
            letter-spacing: 3px;
            text-shadow: 0 0 20px rgba(0,255,255,1);
        }
        
        .core-subtext {
            font-size: 0.7rem;
            margin-top: 5px;
            color: #80e5ff;
            letter-spacing: 2px;
        }
        
        .resource-node {
            position: absolute;
            width: 120px;
            height: 120px;
            background: rgba(0,30,50,0.9);
            border: 2px solid #00ffff;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .resource-node:hover {
            background: rgba(0,255,255,0.2);
            transform: scale(1.15);
            box-shadow: 0 0 40px rgba(0,255,255,0.9);
        }
        
        .node-icon {
            font-size: 2.2rem;
            margin-bottom: 8px;
            filter: drop-shadow(0 0 5px rgba(0,255,255,0.6));
        }
        
        .node-label {
            font-size: 0.75rem;
            font-weight: 700;
            text-align: center;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0,255,255,0.8);
            letter-spacing: 1px;
        }
        
        .node-1 { top: -60px; left: 50%; transform: translateX(-50%); }
        .node-2 { top: 5%; right: 5%; }
        .node-3 { top: 30%; right: -60px; }
        .node-4 { bottom: 30%; right: -60px; }
        .node-5 { bottom: 5%; right: 5%; }
        .node-6 { bottom: -60px; left: 50%; transform: translateX(-50%); }
        .node-7 { bottom: 5%; left: 5%; }
        .node-8 { bottom: 30%; left: -60px; }
        .node-9 { top: 30%; left: -60px; }
        .node-10 { top: 5%; left: 5%; }
        
        /* ChatGPT Assistant Panel */
        .chat-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            width: 800px;
            max-width: 95vw;
            height: 80vh;
            background: rgba(0,10,20,0.98);
            border: 3px solid #00ffff;
            border-radius: 15px;
            padding: 0;
            opacity: 0;
            transition: all 0.4s ease;
            z-index: 1000;
            backdrop-filter: blur(20px);
            box-shadow: 0 0 60px rgba(0,255,255,0.6);
            display: flex;
            flex-direction: column;
        }
        
        .chat-panel.active {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 40px 20px 40px;
            border-bottom: 2px solid rgba(0,255,255,0.3);
        }
        
        .chat-title {
            font-size: 2.2rem;
            font-weight: 900;
            color: #00ffff;
            text-shadow: 0 0 20px rgba(0,255,255,0.8);
            letter-spacing: 3px;
        }
        
        .close-btn {
            width: 50px;
            height: 50px;
            background: transparent;
            border: 2px solid #00ffff;
            border-radius: 50%;
            color: #00ffff;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(0,255,255,0.3);
            transform: rotate(90deg);
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 30px 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 12px;
            line-height: 1.6;
            animation: messageAppear 0.3s ease-out;
        }
        
        @keyframes messageAppear {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .message.user {
            align-self: flex-end;
            background: linear-gradient(135deg, rgba(0,200,255,0.3), rgba(0,255,255,0.3));
            border: 1px solid rgba(0,255,255,0.5);
        }
        
        .message.assistant {
            align-self: flex-start;
            background: rgba(0,50,80,0.3);
            border: 1px solid rgba(0,255,255,0.3);
        }
        
        .message.system {
            align-self: center;
            background: rgba(255,170,0,0.1);
            border: 1px solid rgba(255,170,0,0.3);
            color: #ffaa00;
            font-size: 0.9rem;
            max-width: 90%;
            text-align: center;
        }
        
        .chat-input-container {
            padding: 20px 40px 30px 40px;
            border-top: 2px solid rgba(0,255,255,0.3);
            display: flex;
            gap: 15px;
        }
        
        .chat-input {
            flex: 1;
            padding: 15px 20px;
            background: rgba(0,50,80,0.3);
            border: 2px solid rgba(0,255,255,0.5);
            border-radius: 10px;
            color: #00ffff;
            font-family: 'Orbitron', monospace;
            font-size: 1rem;
            resize: none;
            min-height: 50px;
            max-height: 150px;
        }
        
        .chat-input:focus {
            outline: none;
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0,255,255,0.4);
        }
        
        .send-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, rgba(0,200,255,0.9), rgba(0,255,255,0.9));
            border: 2px solid #00ffff;
            border-radius: 10px;
            color: #000;
            font-family: 'Orbitron', monospace;
            font-size: 1.1rem;
            font-weight: 900;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 30px rgba(0,255,255,0.8);
        }
        
        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            padding: 15px 20px;
            background: rgba(0,50,80,0.3);
            border: 1px solid rgba(0,255,255,0.3);
            border-radius: 12px;
        }
        
        .typing-indicator.show {
            display: block;
        }
        
        .typing-dots {
            display: flex;
            gap: 5px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #00ffff;
            border-radius: 50%;
            animation: typingDot 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingDot {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }
        
        @media (max-width: 1024px) {
            .central-system {
                width: 500px;
                height: 500px;
            }
            .resource-node {
                width: 90px;
                height: 90px;
            }
            .node-icon {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="grid-overlay"></div>
    <div class="scanlines"></div>
    
    <!-- Settings Icon -->
    <div class="settings-icon" onclick="toggleSettings()">‚öôÔ∏è</div>
    
    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2 class="settings-title">API SETTINGS</h2>
            <button class="close-settings" onclick="toggleSettings()">√ó</button>
        </div>
        
        <div class="input-group">
            <label class="input-label">OPENAI API KEY</label>
            <input type="password" class="api-input" id="apiKey" placeholder="sk-...">
        </div>
        
        <button class="save-btn" onclick="saveApiKey()">SAVE API KEY</button>
        
        <div class="info-text">
            <strong>HOW TO GET YOUR API KEY:</strong><br><br>
            1. Go to <a href="https://platform.openai.com/api-keys" target="_blank" style="color:#00ffff">platform.openai.com/api-keys</a><br>
            2. Sign up or log in<br>
            3. Click "Create new secret key"<br>
            4. Copy the key (starts with sk-)<br>
            5. Paste above and click SAVE<br><br>
            <strong>PRICING:</strong> $5 free credit. ~$0.002 per conversation.<br>
            <strong>SECURITY:</strong> Key stored in browser localStorage only.
        </div>
    </div>
    
    <!-- Corner frames -->
    <div class="corner-frame corner-tl"></div>
    <div class="corner-frame corner-tr"></div>
    <div class="corner-frame corner-bl"></div>
    <div class="corner-frame corner-br"></div>
    
    <!-- Info panels -->
    <div class="info-panel panel-tl">
        <div class="panel-label">SYSTEM STATUS</div>
        <div class="panel-value" id="systemStatus">STANDBY</div>
    </div>
    
    <div class="info-panel panel-tr">
        <div class="panel-label">TIME</div>
        <div class="panel-value" id="time-display">--:--:--</div>
    </div>
    
    <div class="info-panel panel-bl">
        <div class="panel-label">3D RESOURCES</div>
        <div class="panel-value">10 ACTIVE</div>
    </div>
    
    <div class="info-panel panel-br">
        <div class="panel-label">AI ASSISTANT</div>
        <div class="panel-value" id="aiStatus">OFFLINE</div>
    </div>
    
    <!-- Main HUD -->
    <div class="hud-container">
        <div class="central-system">
            <div class="ring ring-1"></div>
            <div class="ring ring-2"></div>
            <div class="ring ring-3"></div>
            <div class="ring ring-4"></div>
            
            <div class="core" onclick="openChat()">
                <div class="core-text">JARVIS</div>
                <div class="core-subtext">AI ASSISTANT</div>
            </div>
            
            <!-- Resource nodes -->
            <div class="resource-node node-1" onclick="openLink('https://www.thingiverse.com')">
                <div class="node-icon">üì¶</div>
                <div class="node-label">THINGIVERSE</div>
            </div>
            
            <div class="resource-node node-2" onclick="openLink('https://makerworld.com')">
                <div class="node-icon">üè≠</div>
                <div class="node-label">MAKERWORLD</div>
            </div>
            
            <div class="resource-node node-3" onclick="openLink('https://www.printables.com')">
                <div class="node-icon">üñ®Ô∏è</div>
                <div class="node-label">PRINTABLES</div>
            </div>
            
            <div class="resource-node node-4" onclick="openLink('https://cults3d.com')">
                <div class="node-icon">üé®</div>
                <div class="node-label">CULTS3D</div>
            </div>
            
            <div class="resource-node node-5" onclick="openLink('https://www.myminifactory.com')">
                <div class="node-icon">üè∞</div>
                <div class="node-label">MINIFACTORY</div>
            </div>
            
            <div class="resource-node node-6" onclick="openLink('https://3d.hunyuan.tencent.com/')">
                <div class="node-icon">ü§ñ</div>
                <div class="node-label">HUNYUAN AI</div>
            </div>
            
            <div class="resource-node node-7" onclick="openLink('https://www.cgtrader.com/3d-print-models')">
                <div class="node-icon">üíé</div>
                <div class="node-label">CGTRADER</div>
            </div>
            
            <div class="resource-node node-8" onclick="openLink('https://thangs.com')">
                <div class="node-icon">üîç</div>
                <div class="node-label">THANGS</div>
            </div>
            
            <div class="resource-node node-9" onclick="openLink('https://www.yeggi.com')">
                <div class="node-icon">üåê</div>
                <div class="node-label">YEGGI</div>
            </div>
            
            <div class="resource-node node-10" onclick="openLink('https://www.instructables.com/3D-Printing/')">
                <div class="node-icon">üìö</div>
                <div class="node-label">INSTRUCTABLES</div>
            </div>
        </div>
    </div>
    
    <!-- ChatGPT Assistant Panel -->
    <div class="chat-panel" id="chatPanel">
        <div class="chat-header">
            <h2 class="chat-title">JARVIS AI</h2>
            <button class="close-btn" onclick="closeChat()">√ó</button>
        </div>
        
        <div class="chat-messages" id="chatMessages">
            <div class="message system">
                ü§ñ JARVIS AI Assistant Online<br>
                Ask me anything about 3D printing, modeling, your projects, or workshop help!
            </div>
        </div>
        
        <div class="typing-indicator" id="typingIndicator">
            <div class="typing-dots">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="chat-input-container">
            <textarea 
                class="chat-input" 
                id="chatInput" 
                placeholder="Ask JARVIS anything..."
                onkeydown="handleKeyPress(event)"
            ></textarea>
            <button class="send-btn" id="sendBtn" onclick="sendMessage()">SEND</button>
        </div>
    </div>
    
    <script>
        let apiKey = localStorage.getItem('openai_api_key') || '';
        let conversationHistory = [];
        
        // Initialize
        updateStatus();
        
        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (!key) {
                alert('Please enter your OpenAI API key!');
                return;
            }
            if (!key.startsWith('sk-')) {
                alert('Invalid API key format. OpenAI keys start with "sk-"');
                return;
            }
            localStorage.setItem('openai_api_key', key);
            apiKey = key;
            updateStatus();
            alert('API Key saved successfully! ‚úì');
            toggleSettings();
        }
        
        function updateStatus() {
            const systemStatus = document.getElementById('systemStatus');
            const aiStatus = document.getElementById('aiStatus');
            
            if (apiKey) {
                systemStatus.textContent = 'ONLINE';
                systemStatus.style.color = '#00ff88';
                aiStatus.textContent = 'READY';
                aiStatus.style.color = '#00ff88';
            } else {
                systemStatus.textContent = 'STANDBY';
                aiStatus.textContent = 'OFFLINE';
                aiStatus.style.color = '#ffaa00';
            }
        }
        
        function updateTime() {
            const now = new Date();
            document.getElementById('time-display').textContent = now.toLocaleTimeString('en-US', { hour12: false });
        }
        setInterval(updateTime, 1000);
        updateTime();
        
        function toggleSettings() {
            document.getElementById('settingsPanel').classList.toggle('active');
        }
        
        function openLink(url) {
            window.open(url, '_blank');
        }
        
        function openChat() {
            if (!apiKey) {
                alert('Please configure your OpenAI API key first!\n\nClick the settings icon (‚öôÔ∏è) on the right.');
                toggleSettings();
                return;
            }
            document.getElementById('chatPanel').classList.add('active');
            document.getElementById('chatInput').focus();
        }
        
        function closeChat() {
            document.getElementById('chatPanel').classList.remove('active');
        }
        
        function addMessage(text, type) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            const sendBtn = document.getElementById('sendBtn');
            typingIndicator.classList.add('show');
            sendBtn.disabled = true;
            
            // Add to conversation history
            conversationHistory.push({
                role: 'user',
                content: message
            });
            
            try {
                // Call OpenAI API
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: 'You are JARVIS, an AI assistant integrated into a 3D printing workshop interface. You help with 3D modeling, printing, workshop projects, troubleshooting, and general maker questions. Be helpful, concise, and technical when needed. You have access to 10 STL repositories (Thingiverse, MakerWorld, Printables, Cults3D, MyMiniFactory, CGTrader, Thangs, Yeggi, Instructables) and Hunyuan AI for 3D generation.'
                            },
                            ...conversationHistory
                        ],
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.status}`);
                }
                
                const data = await response.json();
                const assistantMessage = data.choices[0].message.content;
                
                // Add assistant response
                conversationHistory.push({
                    role: 'assistant',
                    content: assistantMessage
                });
                
                addMessage(assistantMessage, 'assistant');
                
            } catch (error) {
                console.error('Error:', error);
                addMessage('‚ùå Error connecting to AI. Please check your API key and try again.', 'system');
            } finally {
                typingIndicator.classList.remove('show');
                sendBtn.disabled = false;
                input.focus();
            }
        }
        
        // Load saved API key
        if (apiKey) {
            document.getElementById('apiKey').value = apiKey;
        }
        
        // Close on ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeChat();
                if (document.getElementById('settingsPanel').classList.contains('active')) {
                    toggleSettings();
                }
            }
        });
    </script>
</body>
</html>
